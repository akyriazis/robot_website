<!DOCTYPE html>
<html>
    <head>
        
        <title>BATBOT</title>
        <meta charset="utf-8">
        
        <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
        <link href="css/lightbox.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="css/style.css">
        
        <link href='https://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900' rel='stylesheet' type='text/css'>    
        
        <script language="javascript" src="js/shCore.js"></script>
        <script language="javascript" src="js/shBrushCpp.js"></script>
        
        <link type="text/css" rel="stylesheet" href="css/shCore.css"></link>
        <link type="text/css" rel="stylesheet" href="css/shCoreDefault.css"></link>

        
    </head>

    <body>

        
        <div id="hero">
            <div id="nav">
                <ul class="cl-effect-13"> 
                    <li><a class="page-scroll" href="#team">Team</a></li>
                    <li><a class="page-scroll" href="#challenge">Challenge</a></li>
                    <li><a class="page-scroll" href="#design">Design</a></li>
                    <li><a class="page-scroll" href="#competition">Competition</a></li>
                    <li><a class="page-scroll" href="#thoughts">Thoughts</a></li>
                </ul>
            </div>
            
            <h1 id="title">
                BATBOT
            </h1>
            
            <h3 id="subtitle">
                ENPH 253 Robot competition 2015
            </h3>
            <div id="github">
                <a href="https://github.com/shahriarnz14/batbot">
                    <img class="svg" src="img/github.svg">
                </a>
            </div>

        
            
        </div>
        
        <div class="content-block black-textured">
            <div class="container">
                <div class="tiles">
                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/angle1.jpg" data-lightbox="images">
                                <img src="img/robot/angle1.jpg">
                            </a>
                        </div>
                    </div>
                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/back1.jpg" data-lightbox="images">
                                <img src="img/robot/back1.jpg">
                            </a>
                        </div>
                    </div>

                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/angle2.jpg" data-lightbox="images">
                                <img src="img/robot/angle2.jpg">
                            </a>
                        </div>
                    </div>
                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/angle3.jpg" data-lightbox="images">
                                <img src="img/robot/angle3.jpg">
                            </a>
                        </div>
                    </div>
                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/front1.jpg" data-lightbox="images">
                                <img src="img/robot/front1.jpg">
                            </a>
                        </div>
                    </div>
                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/side1.jpg" data-lightbox="images">
                                <img src="img/robot/side1.jpg">
                            </a>
                        </div>
                    </div>
                    
                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/side2.jpg" data-lightbox="images">
                                <img src="img/robot/side2.jpg">
                            </a>
                        </div>
                    </div>    
                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/shahriar_pose.jpg" data-lightbox="images">
                                <img src="img/robot/shahriar_pose.jpg">
                            </a>
                        </div>
                    </div>  
                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/angle4.JPG" data-lightbox="images">
                                <img src="img/robot/angle4.JPG">
                            </a>
                        </div>
                    </div>    
                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/front2.JPG" data-lightbox="images">
                                <img src="img/robot/front2.JPG">
                            </a>
                        </div>
                    </div>    
                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/back3.JPG" data-lightbox="images">
                                <img src="img/robot/back3.JPG">
                            </a>
                        </div>
                    </div>   
                    <div class="tile">
                        <div class="tile-content">
                            <a href="img/robot/start1.JPG" data-lightbox="images">
                                <img src="img/robot/start1.JPG">
                            </a>
                        </div>
                    </div>   
                </div>
            </div>
        </div>
        
        
        <div class="content-block white-textured" name="team">
            <div class="container">
                <h2>The Team</h2>
                
                <div class="content-img">
                    <img src="img/robot/Time%20Trials%20Suspense.jpg">
                </div>
                
                <div class="content-text">
                    <p>From Left to Right:</p>
                    
                    <ul class="team-members">
                        <li>
                            <p>Alex Kyriazis</p>
                            <a href="http://ca.linkedin.com/pub/alex-kyriazis/81/7b5/1b3">
                                <div class="circle-btn linked-in">
                                    <p>in</p>
                                </div>
                            </a>
                            
                        </li>
                        <li>
                            <p>Shahriar Noroozi Zadeh</p>
                            <a href="https://www.linkedin.com/pub/shahriar-noroozi-zadeh/a4/69b/a41">
                                <div class="circle-btn linked-in">
                                    <p>in</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <p>William Choi</p>
                            <a href="#">
                                <div class="circle-btn linked-in">
                                    <p>in</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <p>Lap-Tak Chu</p>
                            <a href="#">
                                <div class="circle-btn linked-in">
                                    <p>in</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <p>Amir Refaee</p>
                            <a href="#">
                                <div class="circle-btn linked-in">
                                    <p>in</p>
                                </div>
                            </a>
                        </li>
                    </ul>

                    

                </div>
            </div>
        </div>

        <div class="content-block black-textured" name="challenge">
            <div class="container">
                <h2>The Challenge</h2>

                <div class="col-md-6 content-text">
                    <p>
                                                
                        Taken from the Engineering Physics Competition Website
                    </p>
                    <p>
“Sixteen teams of UBC Engineering Physics students are set to compete in  “Robot Pet Rescue!” the 15th Annual UBC Engineering Physics Robot Competition.    Teams have been challenged to build robots that could autonomously locate and rescue up to six small stuffed animals representing pets stranded in a building, using whatever means they can to return the pets to safety.    All of the robots will be doing all tasks fully automatically from their onboard computers without any remote controls or human interference.
                    </p>
                    <p>
The groups have made full use of the fabrication tools as used in industry – 3d printing to manufacture critical plastic pieces for their robots, laser cutting to fabricate structures in plastic and wood, and waterjet cutting for elements in sheet metal which forms the majority of their robot.  These same tools are used in industry, and give students a great design experience in bringing together a fully-functional prototype – all in under 5 weeks of build-time.”
                    </p>
                    <p>
                        More information can be found at: <a href="http://projectlab.engphys.ubc.ca/enph-253-2015/competition-2015/"> http://projectlab.engphys.ubc.ca/enph-253-2015/competition-2015/
</a>
                    </p>
                </div>
                
                <div class="col-md-6">
                    <div class="content-img">
                        <img src="img/robot/back2.JPG">
                    </div>
                </div>
                
                <div class="col-md-12 content-img">
                    <img src="img/other/course.png">
                </div>
                <div class="col-md-12 content-text">

                    <strong>The course</strong>

                    <p>
                        The pets are scattered around the course that can be navigated for the most part by following the line of black electrical tape. At a certain point, the tape stops and robots must navigate by following 10kHz Infrared radiation. Robots are forced to move quickly because a "wall of fire" comes up after 60 seconds preventing robots from making a return trip, should they be trapped before the wall. In order for the robot to score any points, they have to return the rescued pets back to the safe zone. 
                    </p>
    
                </div>

            
            </div>
        </div>
        
        <div class="content-block cool-textured" name="design">
            <div class="container">
                <h2>The Design</h2>

                <div class="col-md-6 content-img">
                    <img src="img/robot/solidworks_old.png">
                </div>
                <div class="col-md-6 content-img">
                    <img src="img/robot/chassis.png">
                </div>
                <div class="content-text col-md-12">
                    
                    <p>
                    In short, the goal of the competition is to navigate through the pre-designed course, rescuing stuffed animals that will be at predetermined positions on the course, and returning them to the start/safe area. Each pet’s relative position, orientation and obstacles vary, forcing us to design for a variety of pet retrieval situations. Navigation is primarily accomplished through the following of black tape by emitting and detecting IR, which will outline the path of the course, with the exception of the last part where IR detection is needed to detect independent IR emitters.
                    </p>
                    <p>
    Our strategy is to first go up to the second platform of the competition surface as quickly as possible. From here, pet #4 will be passively collected by a magnet, and pet #5 will be picked up along the way by our arm, and put into storage. We will IR follow to the box where we will pick up pet #6 with the arm and hold it. From here, we will use the IR Backup Beacon to orientate ourselves and move back towards the tape. We will leave the upper platform in less than 60 seconds to avoid the "wall of fire". After we start tracking tape again, we will drop pet #6 into the Rescue Area by 'scraping' it off the magnet using the edge. We will pick up pet #3 and drop it off the edge in the same manner. On our way back to the Rescue Area, we will pick up pet #2 with the arm, store it, pick up pet #1 and hold it until the safe zone.
                    </p>
                    <p>
   Our design includes a planetary gear system that would allow us to practically get a high gear ratio of 7. This would give us the high wheel torque needed to climb the ramp. In addition, we decided to build an extremely versatile arm capable of performing all tasks in the course rather than multiple specialized arms. 
                    </p>
                    <p>
                        All programming interfaces through a TINAH board, a deriviative of the Arduino board.
                    </p>
                </div>
                
                <div class="content-img col-md-12">
                    <img src="img/robot/solidworks.png">
                </div>


                <div class="content-video">
                    <iframe src="https://www.youtube.com/embed/I_EyGAGnkWI" frameborder="0" width="560" height="315"></iframe>
                </div>                    
                
            </div>
        </div>
        
        <div class="content-block black-textured">
            <div class="container">
                <h2>Drive System</h2>
            
                <div class="col-md-6">
                    
                    <div class="content-text">
                        <p>Our robot's drive system was built using planetary gears. For each wheel, our DC geared motor drove a small 'planet' gear. This gear would drive a 'sun' gear which would in turn drive 2 more planets. All of these planets would spin an outer ring which is rigidly connected to the wheel. The result is a stable system that can drive a wheel with a high gear ratio. We aimed for a gear ratio of 7 in order to have enough torque to climb the ramp. </p>                    
                    </div>
                    <div class="content-img">
                    
                        <img src="img/robot/wheels.JPG">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="content-img">
                        <img src="img/robot/gears.jpg">
                    </div>
                    <div class="content-img">
                        <img src="img/robot/gear_schematic.png">
                    </div>
                </div>
                <div class="content-video col-md-12">
                    <iframe src="https://www.youtube.com/embed/oGQ9VLuesck" frameborder="0" width="560" height="315"></iframe>
                </div>  
            </div>
        </div>
        
       <div class="content-block cool-textured">
            <div class="container">
                <h2>The Arm</h2>
                

                <div class="content-text col-md-6">
                    <p>From conception the arm was designed with the intent of making it versatile enough to singlehandedly retrieve most of the pets.  This included pet 6 which was covered with foam and pet 5 which was elevated 8 inches from the ground.  We decided to adopt the parallelogram linkage system to attain this versatility.   The location of the servos at the base of the arm enables higher degree of positioning accuracy and the two 4-bar linkages keep the metal plate at the end of the arm always parallel to ground.   The final design was completed on Solidworks and prototyped using the laser cutter with the flexibility of being water-jet cut out of sheet aluminum.  The resulting arm has full three-dimensional freedom and a reach of nearly 14 inches.  
                    </p>
                    <p>
To fully take advantage of this versatile design, we wrote a program that enabled keyboard control of the arm.  <a href="https://processing.org/">Processing </a> was used in addition to the Arduino IDE to relay serial communication between the keyboard and the Arduino.  The program also had unique functionalities allowing us to save and replay different positions of the arm.  All saved coordinates were printed programmatically on a .txt file for future reference.
                    </p>
                </div>
                
                <div class="content-img col-md-6">
                    <img src="img/robot/arm_schematic.png">
                </div>
                <div class="content-img col-md-12">
                    <img src="img/robot/arm.JPG">
                </div>      
                
                <div class="col-md-12">
                    <div class="content-video">
                        <iframe src="https://www.youtube.com/embed/IoXZpQUXito" frameborder="0" width="560" height="315"></iframe>
                    </div>
                    <div class="content-video">
                        <iframe src="https://www.youtube.com/embed/Ajw0IF3jns0" frameborder="0" width="560" height="315"></iframe>
                    </div>    
                    <div class="content-video">
                        <iframe src="https://www.youtube.com/embed/UuypaQdwNr4" frameborder="0" width="560" height="315"></iframe>
                    </div>      
                </div>

           </div>
        </div>
        
        <div class="content-block black-textured">
            <div class="container">
                <h2>Electrical System </h2>
                <div class="content-text col-md-6">                
                    <p>
                    There are several different electrical components that control the functions of our robot.
                    </p>
                    <p>
    To accompany the drive system, are two H-bridge circuits, one for each wheel. These circuits are designed to drive our two geared motors with high current, while giving us signal control to switch the direction of current, so we can drive each motor in both directions.  This is made possible using MOSFETs, which allow the driving of large currents with signals that we output from our TINAH board.
                    </p>
                    <p>
    As part of our challenge includes navigating towards 10kHz IR radiation, we had to design a circuit that can convert this radiation into analog signals our TINAH understands. We designed a circuit that senses IR radiation, filters 10kHz components, amplifies it, and rectifies it, so it is suitable.
                    </p>
                    <p>
    Other circuits shown in the figure above include a debouncing circuit to solve some switch bouncing issues, and circuits that serve organizational purposes.
                    </p>
                    
                </div>
                <div class="col-md-6 content-img">
                
                    <img src="img/robot/circuits.JPG">
                </div>
                <div class="content-img">
                                    <img src="img/robot/circuits_inside.jpg">

                </div>
                <div class="content-video">
                    <iframe src="https://www.youtube.com/embed/OjpHXsLoY_A" frameborder="0" width="560" height="315"></iframe>
                </div>  

                
            </div>
        </div>
        
        <div class="content-block white-textured">
            <div class="container">
                <h2>Software Algorithms</h2>
                
                <div class="content-text">
                    <p>
                        <strong>Tape Following</strong>    
                    </p>
                    <p>
    Our tape following algorithm used a PID control system. Every step, we look our 2 reflective object sensor which our pointed at the ground. If their values are above a set threshold, they are considered high, otherwise they are considered low. The combination of high or low for the left and right sensor determines the amount of ‘error’ of the robot being off the tape. Our drive system responds accordingly by an amount proportional to error, the derivative of error and the integral of error.
                    </p>
                    <p>
    One issue that gave us lots of problems was noise that affected our sensor values. We introduced average filtering in order to remove these problems.
                    </p>
                    
                    <p>
                        Be sure to check out the rest of our code at <a href="https://github.com/shahriarnz14/batbot">our robot's github page </a>
                    </p>
                
                </div>
                
                <pre name="code" class="brush: cpp">

void tapeFollowTime(int16_t speed, long timeMS, int16_t kP, int16_t kD, int16_t &lerr)
{
	// PID Variables
	
	int16_t recerr = 0;
	int16_t q = 0;
	int16_t m = 0;

	int TICKS = 40;

	long startTime = millis();

	while (millis() - startTime &lt timeMS)
	{

		uint16_t sum_left = 0;
		uint16_t sum_right = 0;

		for (int i=0; i&lt TICKS; i++) {
			sum_left += analogRead(LEFT_QRD);
			sum_right += analogRead(RIGHT_QRD);
		}

		uint16_t left = sum_left/TICKS;
		uint16_t right = sum_right/TICKS;
		uint16_t side = analogRead(SIDE_QRD);

		int16_t error = 0;

		if ((left > THRESH_L) && (right > THRESH_R)) error = 0;
		if ((left > THRESH_L) && (right &lt THRESH_R)) error = -1;
		if ((left &lt THRESH_L) && (right > THRESH_R)) error = +1;

		// History for both tapes off the tape
		if ((left &lt THRESH_L) && (right &lt THRESH_R))
		{
			if (lerr > 0) { error = 3; }
			else { error = -3; }
		}

		// Derivative Approximation
		if (error != lerr)
		{
			recerr = lerr;
			q = m;
			m = 1;
		}

		// Integral Approximation
        /*
		if (millis() > INTEGRAL_UPDATE_DELAY_MS + last_integral_update_ms)
		{
		integ += kI.Value * error;
		last_integral_update_ms = millis();
		}

		if (integ > I_MAX) integ = I_MAX;
		else if (-integ > I_MAX) integ = -I_MAX;
        */
		int16_t p = kP*error;
		int16_t d = (int16_t)((float)kD*(float)(error - recerr) / (float)(q + m));
		int16_t con = p + d;// +integ;

		m++;

		int16_t speedRight = speed + con;
		int16_t speedLeft = speed - con;

		motor.speed(LEFT_MOTOR, speedLeft);
		motor.speed(RIGHT_MOTOR, speedRight);

		lerr = error;
	}
	motor.stop_all();
}
</pre>
                <div class="content-video">
                    <iframe src="https://www.youtube.com/embed/6srOKjix-5c" frameborder="0" width="560" height="315"></iframe>
                </div>      
            </div>
           
            
        </div>
        
        <div class="content-block cool-textured" name="competition">
            <div class="container">
                <h2>Competition Results</h2>
                
                <div class="content-text">
                    <p>
                        At the competition, Batbot was able to win its first heat, however lost its second and therefore did not win its group bracket. We were one of 4 robots chosen based on judges’ decision to advance to the quarter-finals for our reliability to score points as well as our potential to score over other robots. Batbot eventually ended up losing in a sudden-death match to a robot that would become later make it to the top 4.
                    </p>
                </div>
 
                
                <div class="content-video">
                    <iframe src="https://www.youtube.com/embed/OiX4UwmzWXA" frameborder="0" width="560" height="315"></iframe>
                </div>  
                
                <div class="content-img">
                    <img src="img/robot/team.jpg">
                </div>
            </div>
        </div>
        
        <div class="content-block black-textured" name="thoughts">
            <div class="container">
                <h2>Final Thoughts</h2>
            
                <div class="content-text">
                    <p>
                We were happy with our results in the competition, but we knew what we could have done to improve our results.
                    </p>
                    <p>
    Our biggest problem in this competition was dealing with electrical noise in our robot. Late in development we discovered that our drive system was the culprit for this incredible amount of noise. This is due to our planetary gear system, which was perhaps overly complicated for what we were trying to accomplish. Too many moving parts caused shaking, which caused the geared motor’s back EMF to fluctuate slightly. This noise could not be fixed through heavy filtering with capacitors and inductors. 
                    </p>
                    <p>
    As a consequence of this noise, we weren’t able to implement rotary encoders into our drive system because there was too much noise to get reliable signals (too many false positive rotations were being signaled). Rotary encoders would have allowed us to encode the robot’s exact position using software. We ended up having to use time based movement rather than position based movement. Our robot’s movement ended up being inconsistent as a result, and our arm wasn’t always able to pick up the pets since the positions relative to the robot varied slightly.
                    </p>
                    <p>

    Another aspect of the robot we might have changed would be our arm design. As mentioned before, we were aiming for a powerful, sophisticated, versatile arm design that could do everything. By observation of other teams, it seems that multiple specialized, robust, simple arms would have been more consistent and may have been a safer bet. We are very proud of the arm design we used, and we appreciate its sophistication, but we acknowledge it was over designed.
                    </p>

                </div>
                <div class="content-img">
                    <img src="img/robot/back1.jpg">
                </div>
            </div>

        </div>
        
    </body>
    
    <script src="js/lightbox-plus-jquery.min.js"></script>
    <script language="javascript" src="js/main.js"></script>

        <script type="text/javascript">
             SyntaxHighlighter.all()
        </script>
        <script language="javascript" src="js/svg_fix.js"></script>

</html>